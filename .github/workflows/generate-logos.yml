name: Generate Intent Solutions IO Logos

on:
  workflow_dispatch:
    inputs:
      variant:
        description: 'Logo variant to generate (01-04, or "all")'
        required: true
        default: 'all'
        type: choice
        options:
          - all
          - '01'
          - '02'
          - '03'
          - '04'

env:
  PROJECT_ID: hustleapp-production
  REGION: us-central1
  GCS_BUCKET: gs://hustleapp-production-logos

jobs:
  generate:
    runs-on: ubuntu-latest
    timeout-minutes: 60
    permissions:
      id-token: write
      contents: write

    steps:
      - name: Checkout
        uses: actions/checkout@v4

      - name: Authenticate to Google Cloud
        id: auth
        uses: google-github-actions/auth@v2
        with:
          workload_identity_provider: ${{ secrets.WIF_PROVIDER }}
          service_account: ${{ secrets.WIF_SERVICE_ACCOUNT }}
          token_format: 'access_token'
          create_credentials_file: true

      - name: Setup gcloud
        uses: google-github-actions/setup-gcloud@v2

      - name: Install dependencies
        run: |
          sudo apt-get update && sudo apt-get install -y jq

      - name: Create output directories
        run: |
          mkdir -p nwsl/tmp/logos/raw
          mkdir -p nwsl/tmp/logos/logs

      - name: Generate logos
        env:
          VARIANT: ${{ github.event.inputs.variant }}
        run: |
          cd nwsl
          chmod +x scripts/generate_intent_logos.sh

          # Set variant filter if not "all"
          if [ "$VARIANT" != "all" ]; then
            export LOGO_FILTER="$VARIANT"
          fi

          ./scripts/generate_intent_logos.sh

      - name: Upload generated logos
        uses: actions/upload-artifact@v4
        with:
          name: intent-solutions-logos-${{ github.run_number }}
          path: nwsl/tmp/logos/raw/*.png
          if-no-files-found: warn
          retention-days: 30

      - name: Summary
        run: |
          echo "## Logo Generation Complete ðŸŽ¨" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "### Generated Logos" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY

          if [ -d nwsl/tmp/logos/raw ] && [ "$(ls -A nwsl/tmp/logos/raw)" ]; then
            echo "| Logo Variant | Files |" >> $GITHUB_STEP_SUMMARY
            echo "|--------------|-------|" >> $GITHUB_STEP_SUMMARY

            for file in nwsl/tmp/logos/raw/*.png; do
              if [ -f "$file" ]; then
                filename=$(basename "$file")
                size=$(du -h "$file" | cut -f1)
                echo "| $filename | $size |" >> $GITHUB_STEP_SUMMARY
              fi
            done
          else
            echo "âš ï¸ No logos generated" >> $GITHUB_STEP_SUMMARY
          fi

          echo "" >> $GITHUB_STEP_SUMMARY
          echo "### Next Steps" >> $GITHUB_STEP_SUMMARY
          echo "1. Download artifacts from this workflow run" >> $GITHUB_STEP_SUMMARY
          echo "2. Review all logo variants" >> $GITHUB_STEP_SUMMARY
          echo "3. Select best variants" >> $GITHUB_STEP_SUMMARY
          echo "4. Vectorize using https://vectorizer.ai" >> $GITHUB_STEP_SUMMARY
          echo "5. Deploy to https://intentsolutions.io" >> $GITHUB_STEP_SUMMARY
